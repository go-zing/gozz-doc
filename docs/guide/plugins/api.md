# Api

Generates `API Routing Map` and type-safe static invoker function from `interface`,
without external framework dependencies.

## Usage

### Annotation

Add annotations on `interface` and method fields

```go
package x

// +zz:api:[filename][:options...]
type T interface {
	// +zz:api:[resource][:options...]
	Method(param Param) (result Result, err error)

	// method without annotations would be ignored
	InternalMethod(param Param) (result Result, err error)

	// anonymous field would be ignored
	AnonymousT
}

```

Example:

```go
package x

// +zz:api:./:prefix=book:public
type BookService interface {
	// +zz:api:get:{id}
	GetBook(id int) (book Book, err error)
}
```

### Exact Arguments For `interface`

#### `filename`

Specify generate filename.

Example:

```go
package x

// +zz:api:./
type T interface{}
```

### Exact Arguments For `interface` method

#### `resource`

would be main property in `API Routing Map`

Example:

```go
package x

// +zz:api:./
type T interface {
	// +zz:api:get|detail
	Method()
}
```

### Optional Arguments

You can use any `Key-Value` pairs options in this plugin.
They would be collect into `API Routing Map`'s field `options` as a `map[string]string`.

options on `interface` would try override `field` options：

```go
package x

// +zz:api:./:prefix=book:role=read
type BookService interface {
	// +zz:api:get
	ListBook() (book []Book, err error)
	// +zz:api:get|{id}
	GetBook(id int) (book Book, err error)
	// +zz:api:post|{id}:role=write
	NewBook(book Book) (id int, err error)
	// +zz:api:put|{id}:role=write
	UpdateBook(book Book) (err error)
}
```

is equal to:

```go
package x

// +zz:api:./
type BookService interface {
	// +zz:api:get:prefix=book:role=read
	ListBook() (book []Book, err error)
	// +zz:api:get|{id}:prefix=book:role=read
	GetBook(id int) (book Book, err error)
	// +zz:api:post|{id}:prefix=book:role=write
	NewBook(book Book) (id int, err error)
	// +zz:api:put|{id}:prefix=book:role=write
	UpdateBook(book Book) (err error)
}
```

### Convention

#### Invoke Function Generation

Type-safe `invoke` static calling functions can be automatically generated for methods that meet the conditions:

- Methods have at most two params and two returns
- If there are two params, the first param type must be `context.Context`, and the second must be different
- If there are two returns, the second return type must be `error`, and the first must be different

## Examples

### Example-01

[Example Project](https://github.com/go-zing/gozz-doc-examples/tree/main/api01)

```
/api01/
├── go.mod -> module github.com/go-zing/gozz-doc-examples/api01
└── types.go
```

<<< @/gozz-doc-examples/api01/types.go

This Example has two `interface`, provide entity basic `CRUD` for `User` and `Book`.

Execute `gozz run -p "api" ./`, and it generates file `zzgen.api.go` and template file.

<<< @/gozz-doc-examples/api01/zzgen.api.go

- We could use generated `invoke` function to connect with types of protocol library and do request binding,
  then invoke the interface method call and get return values in these type-safe static codes.
- With help of DI of plugin [wire](wire.md), we could do automatic interface and api binding to provide API
  services.
- With help of comments mapping table generated by plugin [doc](doc.md),
  we could also generate API docs when `interface` and types were designed.
- Use optional arguments `options` to do flexibly middlewares and middlewares params management,
  to do more functions like permission control, or OpenAPI.

### Example-02

[Example Project](https://github.com/go-zing/gozz-doc-examples/tree/main/api02)

This example would show wide scope supporting of `invoke` static function generating.

<<< @/gozz-doc-examples/api02/types.go

Execute `gozz run -p "api" ./`, and it generates file `zzgen.api.go` and template file.

<<< @/gozz-doc-examples/api02/zzgen.api.go